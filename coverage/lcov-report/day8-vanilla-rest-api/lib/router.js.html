<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for day8-vanilla-rest-api/lib/router.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">All files</a> / <a href="index.html">day8-vanilla-rest-api/lib</a> router.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">61.54% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>16/26</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">50% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>1/2</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">66.67% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>6/9</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">61.54% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>16/26</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
&nbsp;
// THIS FILE: NOT building routes themselves, but holding the methods
// Going to be dealing with GET POST PUT DELETE methods, need to parse both URL and JSON
// Router constructor with a routes property, which contains its own sub object
&nbsp;
// first two lines are pulling in two middleware things we built to interact with request
const parseUrl = require('./parse-url.js');
const parseJson = require('./parse-json.js')
&nbsp;
const Router = module.exports = function() {
  this.routes = {
    // 'this' is used because we're in a constructor
    GET: {},
    POST: {},
    PUT: {},
    DELETE: {}
  }
}
&nbsp;
// prototype methods:
Router.prototype.get = function(endpoint, callback) {
  // app.get(/api/cats, function(data) {})
  // gives routers access to the get method
  // when we call our GET method, we look at the routes property on our object
&nbsp;
  this.routes.GET[endpoint] = callback;
  // endpoint is passed in (ex: /api/cats), now a property on GET
  // that property has a value of this callback
}
&nbsp;
Router.prototype.post = function(endpoint, callback) {
  this.routes.POST[endpoint] = callback;
}
&nbsp;
Router.prototype.put = <span class="fstat-no" title="function not covered" >fu</span>nction(endpoint, callback) {
<span class="cstat-no" title="statement not covered" >  this.routes.PUT[endpoint] = callback;</span>
}
&nbsp;
Router.prototype.delete = <span class="fstat-no" title="function not covered" >fu</span>nction(endpoint, callback) {
<span class="cstat-no" title="statement not covered" >  this.routes.DELETE[endpoint] = callback;</span>
}
&nbsp;
Router.prototype.route = function() {
  // goal here is to use route call as a way of passing that into our createServer call
  // will return a function with req and res, that can be modified or handled
  // we are going to pipe in this call to our http.createServer()
&nbsp;
  // basically making http.createServer((req,res) =&gt; { }))
  return (req, res) =&gt; {
    // method that accepts an array of Promises - all Promises need to be resolved
    Promise.all([
      parseUrl(req),
      parseJson(req),
    ])
    .then( () =&gt; { 
      // do something if that shit worked
      // this.routes will point to the instantiated object
      // [req.method][req.url.pathname] are in brackets because they have dots in their name, not chaining
      <span class="missing-if-branch" title="else path not taken" >E</span>if (typeof this.routes[req.method][req.url.pathname] === 'function') {
        // when we call our route method from http.createServer(), it will return a function with req/res
        // this is basically handling things like parsing our URL, JSON, allowing us to call any associated paths
        this.routes[req.method][req.url.pathname](req,res);
        return;
      }
      // handle basic errors
<span class="cstat-no" title="statement not covered" >      console.error('Route is not found.');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      res.writeHead(404, {</span>
        // content type is a string because of the hyphen
        // for example, an Authorization header wouldn't have to be a string
        'Content-Type' : 'text/plain'
      });
&nbsp;
<span class="cstat-no" title="statement not covered" >      res.write('route not found');</span>
<span class="cstat-no" title="statement not covered" >      res.end();</span>
    })
    // if one or multiple Promises reject, .then block is skipped entirely
    .catch( <span class="fstat-no" title="function not covered" >er</span>r =&gt; {
      // handling basic bad requests or 400 errors
<span class="cstat-no" title="statement not covered" >      console.error(err);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      res.writeHead(400, {</span>
        'Content-Type' : 'text-plain'
      })
&nbsp;
<span class="cstat-no" title="statement not covered" >      res.write('bad request');</span>
<span class="cstat-no" title="statement not covered" >      res.end();</span>
    })
  }
}
&nbsp;
/* WHITEBOARD:
  {
    GET: {},
    POST: {},
    PUT: {},
    DELETE: {}
  }
  
  var notes = new Router();
  notes.routes prints out GET, POST, PUT, DELETE objects
  
  notes.routes.get = {
    '/api/cats' : callback;
  }
*/</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Wed Feb 21 2018 12:08:54 GMT-0800 (PST)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
